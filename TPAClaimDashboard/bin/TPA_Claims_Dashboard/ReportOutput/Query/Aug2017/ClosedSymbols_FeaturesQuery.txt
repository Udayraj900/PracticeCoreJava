SELECT * FROM (   SELECT    (SELECT TPA_NM FROM TTPA where TPA_ID=X.tpa_id and TXN_XPIRY_DT='12/31/9999' and PRODUCTION_IN='Y' and INIT_RECON_STAT_CD='CMPL') as TPA_NM,   X.lob_cd,   (SELECT MAJOR_CLASS_DS FROM TMAJOR_CLASS where MAJOR_CLASS_CD=X.MAJOR_CLASS_CD and LOB_CD=X.lob_cd )as MAJOR_CLASS_DS,   X.IncludingCWPYeartoDate,   X.IncludingCWPPriorYeartoDate,   (X.IncludingCWPYeartoDate - X.IncludingCWPPriorYeartoDate ) as Year_to_Date_Change,   X.IncludingCWPCurrentMonth,   X.IncludingCWPPriorCurrentMonth,   X.IMLYeartoDate,   X.IMLPriorYeartoDate,   (X.IMLYeartoDate - X.IMLPriorYeartoDate ) as IMLYear_to_Date_Change,   X.IMLCurrentMonth,   X.IMLPriorMonth,   X.CWPYeartoDate,   X.CWPPriorYeartoDate,   (X.CWPYeartoDate - X.CWPPriorYeartoDate) as CWPYear_to_Date_Change,   X.CWPCurrentMonth,   X.CWPPriorCurrentMonth    FROM    (       SELECT       a.TPA_ID,      a.LOB_CD,      a.MAJOR_CLASS_CD,      sum(case when c.LAST_CLOSE_DT>=(Date(YEAR('2017-08-31')||'-'|| '01' || '-' ||'31'))  then 1 else 0 end) as IncludingCWPYeartoDate,      sum(case when c.LAST_CLOSE_DT>=(Date((YEAR('2017-08-31') -1) ||'-'|| '01' || '-' ||'31'))  then 1 else 0 end) as IncludingCWPPriorYeartoDate,      sum(case when c.LAST_CLOSE_DT='2017-08-31' then 1 else 0 end) as IncludingCWPCurrentMonth,      sum(case when c.LAST_CLOSE_DT=(Date((YEAR('2017-08-31') -1)||'-'|| MONTH('2017-08-31') || '-' || DAY('2017-08-31')))  then 1 else 0 end) as IncludingCWPPriorCurrentMonth,      sum(case when c.LAST_CLOSE_DT>=(Date(YEAR('2017-08-31')||'-'|| '01' || '-' ||'31'))  and (b.IN_BI_PTD_AM>0 or b.MD_PD_PTD_AM>0 or b.XPNS_PTD_AM>0 ) then 1 else 0 end ) as IMLYeartoDate,      sum(case when c.LAST_CLOSE_DT>=(Date((YEAR('2017-08-31') -1) ||'-'|| '01' || '-' ||'31'))  and (b.IN_BI_PTD_AM>0 or b.MD_PD_PTD_AM>0 or b.XPNS_PTD_AM>0 ) then 1 else 0 end ) as IMLPriorYeartoDate,      sum(case when c.LAST_CLOSE_DT='2017-08-31' and (b.IN_BI_PTD_AM>0 or b.MD_PD_PTD_AM>0 or b.XPNS_PTD_AM>0 ) then 1 else 0 end ) as IMLCurrentMonth,      sum(case when c.LAST_CLOSE_DT=(Date((YEAR('2017-08-31') -1)||'-'|| MONTH('2017-08-31') || '-' || DAY('2017-08-31')))  and (b.IN_BI_PTD_AM>0 or b.MD_PD_PTD_AM>0 or b.XPNS_PTD_AM>0 ) then 1 else 0 end ) as IMLPriorMonth,      sum(case when c.LAST_CLOSE_DT>=(Date(YEAR('2017-08-31')||'-'|| '01' || '-' ||'31'))  and (b.IN_BI_PTD_AM=0 and b.MD_PD_PTD_AM=0 and b.XPNS_PTD_AM=0 ) then 1 else 0 end )as CWPYeartoDate,      sum(case when c.LAST_CLOSE_DT>=(Date((YEAR('2017-08-31') -1) ||'-'|| '01' || '-' ||'31'))  and (b.IN_BI_PTD_AM=0 and b.MD_PD_PTD_AM=0 and b.XPNS_PTD_AM=0 ) then 1 else 0 end )as CWPPriorYeartoDate,      sum(case when c.LAST_CLOSE_DT='2017-08-31' and (b.IN_BI_PTD_AM=0 and b.MD_PD_PTD_AM=0 and b.XPNS_PTD_AM=0) then 1 else 0 end )as CWPCurrentMonth,      sum      (         case when c.LAST_CLOSE_DT=(Date((YEAR('2017-08-31') -1)||'-'|| MONTH('2017-08-31') || '-' || DAY('2017-08-31')))          and         (            b.IN_BI_PTD_AM=0            and b.MD_PD_PTD_AM=0            and b.XPNS_PTD_AM=0         )         then 1 else 0 end      )      as CWPPriorCurrentMonth       FROM TCLM_SYMBOL a, TCLM_FINCL b, TCLM_SYM_NON_CRTCL c       where a.TPA_ID in (006)       and a.VALUATION_XPIRY_DT='12/31/9999'       and a.TPA_ID=b.TPA_ID       and a.CLIENT_CD=b.CLIENT_CD       and a.BRANCH_NO=b.BRANCH_NO       and a.CASE_NO=b.CASE_NO       and a.CASE_SYMBOL_NO=b.CASE_SYMBOL_NO       and a.SYMBOL_CREATE_DT=b.SYMBOL_CREATE_DT       and c.TPA_ID=b.TPA_ID       and c.CLIENT_CD=b.CLIENT_CD       and c.BRANCH_NO=b.BRANCH_NO       and c.CASE_NO=b.CASE_NO       and c.CASE_SYMBOL_NO=b.CASE_SYMBOL_NO       and c.SYMBOL_CREATE_DT=b.SYMBOL_CREATE_DT       and a.VALUATION_XPIRY_DT='12/31/9999'       and b.FINCL_VALTN_XPR_DT>='2017-08-31'       and b.FINCL_XPIR_DT='12/31/9999'       and c.LAST_CLOSE_DT>=(Date((YEAR('2017-08-31') -1) ||'-'|| '01' || '-' ||'31'))        group by a.TPA_ID,a.LOB_CD, a.MAJOR_CLASS_CD    )    X    UNION    SELECT    (SELECT TPA_NM FROM TTPA where TPA_ID=Y.tpa_id and TXN_XPIRY_DT='12/31/9999' and PRODUCTION_IN='Y' and INIT_RECON_STAT_CD='CMPL') as TPA_NM,    Y.lob_cd,   'zSummary',   Y.IncludingCWPYeartoDate,   Y.IncludingCWPPriorYeartoDate,   (Y.IncludingCWPYeartoDate - Y.IncludingCWPPriorYeartoDate ),   Y.IncludingCWPCurrentMonth,   Y.IncludingCWPPriorCurrentMonth,   Y.IMLYeartoDate,   Y.IMLPriorYeartoDate,   (Y.IMLYeartoDate - Y.IMLPriorYeartoDate ),   Y.IMLCurrentMonth,   Y.IMLPriorMonth,   Y.CWPYeartoDate,   Y.CWPPriorYeartoDate,   (Y.CWPYeartoDate - Y.CWPPriorYeartoDate),   Y.CWPCurrentMonth,   Y.CWPPriorCurrentMonth    FROM    (      SELECT       a.TPA_ID,      a.LOB_CD,      sum(case when c.LAST_CLOSE_DT>=(Date(YEAR('2017-08-31')||'-'|| '01' || '-' ||'31'))  then 1 else 0 end) as IncludingCWPYeartoDate,      sum(case when c.LAST_CLOSE_DT>=(Date((YEAR('2017-08-31') -1) ||'-'|| '01' || '-' ||'31'))  then 1 else 0 end) as IncludingCWPPriorYeartoDate,      sum(case when c.LAST_CLOSE_DT='2017-08-31' then 1 else 0 end) as IncludingCWPCurrentMonth,      sum(case when c.LAST_CLOSE_DT=(Date((YEAR('2017-08-31') -1)||'-'|| MONTH('2017-08-31') || '-' || DAY('2017-08-31')))  then 1 else 0 end) as IncludingCWPPriorCurrentMonth,      sum(case when c.LAST_CLOSE_DT>=(Date(YEAR('2017-08-31')||'-'|| '01' || '-' ||'31'))  and (b.IN_BI_PTD_AM>0 or b.MD_PD_PTD_AM>0 or b.XPNS_PTD_AM>0 ) then 1 else 0 end ) as IMLYeartoDate,      sum(case when c.LAST_CLOSE_DT>=(Date((YEAR('2017-08-31') -1) ||'-'|| '01' || '-' ||'31'))  and (b.IN_BI_PTD_AM>0 or b.MD_PD_PTD_AM>0 or b.XPNS_PTD_AM>0 ) then 1 else 0 end ) as IMLPriorYeartoDate,      sum(case when c.LAST_CLOSE_DT='2017-08-31' and (b.IN_BI_PTD_AM>0 or b.MD_PD_PTD_AM>0 or b.XPNS_PTD_AM>0 ) then 1 else 0 end ) as IMLCurrentMonth,      sum(case when c.LAST_CLOSE_DT=(Date((YEAR('2017-08-31') -1)||'-'|| MONTH('2017-08-31') || '-' || DAY('2017-08-31')))  and (b.IN_BI_PTD_AM>0 or b.MD_PD_PTD_AM>0 or b.XPNS_PTD_AM>0 ) then 1 else 0 end ) as IMLPriorMonth,      sum(case when c.LAST_CLOSE_DT>=(Date(YEAR('2017-08-31')||'-'|| '01' || '-' ||'31'))  and (b.IN_BI_PTD_AM=0 and b.MD_PD_PTD_AM=0 and b.XPNS_PTD_AM=0 ) then 1 else 0 end )as CWPYeartoDate,      sum(case when c.LAST_CLOSE_DT>=(Date((YEAR('2017-08-31') -1) ||'-'|| '01' || '-' ||'31'))  and (b.IN_BI_PTD_AM=0 and b.MD_PD_PTD_AM=0 and b.XPNS_PTD_AM=0 ) then 1 else 0 end )as CWPPriorYeartoDate,      sum(case when c.LAST_CLOSE_DT='2017-08-31' and (b.IN_BI_PTD_AM=0 and b.MD_PD_PTD_AM=0 and b.XPNS_PTD_AM=0) then 1 else 0 end )as CWPCurrentMonth,      sum      (         case when c.LAST_CLOSE_DT=(Date((YEAR('2017-08-31') -1)||'-'|| MONTH('2017-08-31') || '-' || DAY('2017-08-31')))          and         (            b.IN_BI_PTD_AM=0            and b.MD_PD_PTD_AM=0            and b.XPNS_PTD_AM=0         )         then 1 else 0 end      )      as CWPPriorCurrentMonth       FROM TCLM_SYMBOL a, TCLM_FINCL b, TCLM_SYM_NON_CRTCL c       where a.TPA_ID in (006)       and a.VALUATION_XPIRY_DT='12/31/9999'       and a.TPA_ID=b.TPA_ID       and a.CLIENT_CD=b.CLIENT_CD        and a.BRANCH_NO=b.BRANCH_NO       and a.CASE_NO=b.CASE_NO       and a.CASE_SYMBOL_NO=b.CASE_SYMBOL_NO       and a.SYMBOL_CREATE_DT=b.SYMBOL_CREATE_DT       and c.TPA_ID=b.TPA_ID       and c.CLIENT_CD=b.CLIENT_CD       and c.BRANCH_NO=b.BRANCH_NO       and c.CASE_NO=b.CASE_NO       and c.CASE_SYMBOL_NO=b.CASE_SYMBOL_NO       and c.SYMBOL_CREATE_DT=b.SYMBOL_CREATE_DT       and a.VALUATION_XPIRY_DT='12/31/9999'       and b.FINCL_VALTN_XPR_DT>='2017-08-31'       and b.FINCL_XPIR_DT='12/31/9999'       and c.LAST_CLOSE_DT>=(Date((YEAR('2017-08-31') -1) ||'-'|| '01' || '-' ||'31'))        group by a.TPA_ID, a.LOB_CD    )    Y ) outQuery order by outQuery.TPA_NM, outQuery.LOB_CD,outQuery.MAJOR_CLASS_DS FOR READ ONLY WITH UR